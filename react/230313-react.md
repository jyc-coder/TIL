# Reducer/context

## Reducer

### 1) useReducer?
ìƒíƒœê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” Hookì´ë‹¤.
useStateë¥¼ í†µí•œ ìƒíƒê´€ë¦¬ ë° ë°ì´í„° CRUD ì˜ ê°ì¢… Handlerë¥¼ í•˜ë‚˜ì˜ í•¨ìˆ˜ë¡œ ì‚¬ìš©í• ìˆ˜ ìˆë„ë¡ í•´ì¤€ë‹¤.

ê¸°ë³¸ì ì¸ í˜•íƒœëŠ” ì´ë ‡ë‹¤.

```jsx
const [state, dispatch] = useReducer(ë¦¬ë“€ì„œ ì´ë¦„, ì´ˆê¸°ë°ì´í„°)
```

`state`: ìƒíƒœë¥¼ ëœ»í•œë‹¤. ì´ ì•ˆì— ê°ì¢… ë°ì´í„°ê°€ ë“¤ì–´ê°€ê²Œ ë˜ëŠ”ë°, ì²˜ìŒì— ì´ˆê¸° ë°ì´í„°ë¥¼ 1ë¡œ ì„¤ì •í•˜ë©´, ì´ stateëŠ” 1ì´ ë˜ëŠ” ê²ƒì´ë‹¤. 

`dispatch`ëŠ” í•´ë‹¹ stateì— ëŒ€ì• ì„œ crudë¥¼ ì§„í–‰í•˜ë„ë¡ ë„ì™€ì£¼ëŠ” í•¨ìˆ˜ë¥¼ ëœ»í•œë‹¤. `dispatch(ì§„í–‰í•˜ê³ ì í•˜ëŠ” ì‘ì—…ì´ë¦„)`ì´ëŸ°ì‹ìœ¼ë¡œ ì¨ì£¼ë©´, í•´ë‹¹ state ìˆ˜ì • ì‘ì—…ì´ ì§„í–‰ë˜ëŠ” ê²ƒì´ë‹¤.

 > íŠ¹ì •í•œ ì‘ì—… íƒ€ì…ì„ ëª…ì‹œí•´ì£¼ë©´, í•´ë‹¹ ì‘ì—… íƒ€ì…ì— ë”°ë¼ ì¼ì •í•œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ì£¼ëŠ” ì—­í• ì„ ë‹´ë‹¹í•˜ê²Œ ëœë‹¤.
 
 í•˜ì§€ë§Œ dispatchê°€ íŠ¹ì •í•œ ì‘ì—…ì´ë¦„ì„ ì…ë ¥ë°›ì•˜ì„ ë•Œ, ì–´ë˜ ì‘ì—…ì„ ìˆ˜í–‰í•  ì§€ëŠ” ì•„ì§ ì •í•´ì ¸ ìˆì§€ ì•Šë‹¤. í•´ë‹¹ ë¶€ë¶„ì€ ìš°ë¦¬ê°€ ì§ì ‘ ì •í•´ì•¼ í•˜ëŠ” ê²ƒì´ë‹¤.
 
 
ê·¸ê²ƒì„ ì •ì˜í•˜ëŠ” ê²ƒì´ ë°”ë¡œ ë¦¬ë“€ì„œì´ë‹¤.ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•˜ë©´ dispatch í•¨ìˆ˜ ì‹¤í–‰ì‹œ ì‘ì—… ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” í–‰ë™ì„ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.


```jsx
export function ë¦¬ë“€ì„œ(state, action) {
  switch (action.type) {
    case 'ì‘ì—…ì´ë¦„':
      return í•´ë‹¹ ì‘ì—…ì´ë¦„ìœ¼ë¡œ dispatch í–ˆì„ ë•Œ ì‹¤í–‰ë  ì½”ë“œ
    default:
      throw new Error(`Unhandled action type: ${action.type}`)
  }
}
```

### 2) useReducer ì˜ˆì œ

`constants/userData.js`
```jsx
export const userData = [
  {
    id: 1,
    name: 'Leanne Graham',
    email: 'Sincere@april.biz',
  },
  {
    id: 2,
    name: 'Ervin Howell',
    email: 'Shanna@melissa.tv',
  },
  {
    id: 3,
    name: 'Clementine Bauch',
    email: 'Nathan@yesenia.net',
  },
  {
    id: 4,
    name: 'Patricia Lebsack',
    email: 'Julianne.OConner@kory.org',
  },
  {
    id: 5,
    name: 'Chelsey Dietrich',
    email: 'Lucio_Hettinger@annie.ca',
  },
  {
    id: 6,
    name: 'Mrs. Dennis Schulist',
    email: 'Karley_Dach@jasper.info',
  },
  {
    id: 7,
    name: 'Kurtis Weissnat',
    email: 'Telly.Hoeger@billy.biz',
  },
  {
    id: 8,
    name: 'Nicholas Runolfsdottir V',
    email: 'Sherwood@rosamond.me',
  },
  {
    id: 9,
    name: 'Glenna Reichert',
    email: 'Chaim_McDermott@dana.io',
  },
  {
    id: 10,
    name: 'Clementina DuBuque',
    email: 'Rey.Padberg@karina.biz',
  },
]
```

userDataë¥¼ ì‚¬ìš©í•˜ëŠ” `UserList.jsx`ì»´í¬ë„ŒíŠ¸ ìƒì„±

```jsx
import React, { useState } from 'react'
import { userData } from '../constants/userData'

function UserList() {
  const [users, setUsers] = useState(userData)

  return (
    <div>
      {users.map((user) => {
        return <p>{user.name}</p>
      })}
    </div>
  )
}

export default UserList
```
useStateë¥¼ ì“°ëŠ” ê²½ìš°ì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ìœ¼ë©´, ì´ë ‡ê²Œ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë”°ë¡œ ë§Œë“¤ì–´ì¤˜ì•¼í•œë‹¤.

```jsx
cosnt addUser = (user) => {
  setUsers([...users, user])
```
í•˜ì§€ë§Œ ì´ëŸ¬í•œ state ê´€ë¦¬ ë¡œì§ì´ í•œ ì»´í¬ë„ŒíŠ¸ì— ë„ˆë¬´ ë§ì•„ì ¸ë„ ê³¤ë€í•˜ê³ , ë„ˆë¬´ í©ì–´ì ¸ ìˆì–´ë„ ê³¤ë€í•˜ë‹¤.
ê·¸ë˜ì„œ ìƒíƒœê´€ë¦¬ë¥¼ ì¢€ ì •ëˆí•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ë¡œ `useReducer`ì´ë‹¤.

`userReducer.js`
```jsx
export function userReducer(state, action) {
  switch (action.type) {
    case 'ADD': // ì´ ë¶€ë¶„ì€ {type: 'ADD'} ê°€ ë“¤ì–´ì˜¤ë©´ ì‹¤í–‰
      return [...state, action.data]
    default:
      throw new Error(`Unhandled action type: ${action.type}`)
  }
}
```

í˜„ì¬ ADD ì‘ì—…ë§Œ ìˆë‹¤ê³  ê°€ì •í•´ì„œ ì‘ì„±í•œ ê²ƒì´ë‹¤.

ì´ì œ 
UserList ì»´í¬ë„ŒíŠ¸ë¥¼ ì•„ë˜ì²˜ëŸ¼ ì œì‘í•œë‹¤.
useStateë¥¼ ì œê±°í•˜ê³  userReducerë¥¼ ì‚¬ìš©í–ˆë‹¤ëŠ” ê²ƒì´ í•µì‹¬ í¬ì¸íŠ¸ì´ë‹¤.

```jsx
import React, { useReducer } from 'react'
import { userReducer } from '../reducers/userReducer'
import { userData } from '../constants/userData'

function UserList() {
  const [state, dispatch] = useReducer(userReducer, userData)

  return (
    <div>
      {state.map((user) => {
        return <p>{user.name}</p>
      })}
    </div>
  )
}

export default UserList
```

dispatch ë¥¼ ì‚¬ìš©í•´ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€í•œë‹¤.
ë²„íŠ¼ì„ ë§Œë“¤ê³  ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œê°€ ì‹¤í–‰ ë˜ë„ë¡í•œë‹¤.

```jsx
dispatch({ type: 'ADD', data: { id: 11, name: '11', email: '11' } })
```

ì´ ì½”ë“œëŠ” 
- ê´„í˜¸ ì•ˆì— ëª…ì‹œí•œ ë‚´ìš©ì„ userReducerì—ì„œ actionìœ¼ë¡œ ë°›ì•„ì˜´
- actionì˜ typeì„ í™•ì¸í•´ì„œ ADDì¸ ê²½ìš°ì˜ í•¨ìˆ˜ ë‚´ìš©ì´ ì‹¤í–‰ë¨. ë”°ë¼ì„œ actionì˜ data ë¶€ë¶„ì„ stateì— ì¶”ê°€í•œë‹¤.
```jsx
import React from 'react'
import { useReducer } from 'react'
import { userData } from '../constatnts/userData'
import { userReducer } from '../reducers/userReducer'

function UserList() {
    const [state, dispatch] = useReducer(userReducer, userData)

    return (
        <div>
            {state.map((user) => {
                return <p>{user.name}</p>
            })}
            <button onClick={() => dispatch({ type: 'ADD', data: { id: 11, name: '11', email: 'helloworld.com' } })}>ë””ìŠ¤íŒ¨ì¹˜</button>
        </div>
    )
}

export default UserList

```

![](https://velog.velcdn.com/images/jhs000123/post/5560687f-32b6-4dd8-bdf5-89ec91c8984a/image.png)


ë””ìŠ¤íŒ¨ì¹˜ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ 11ì´ë¼ëŠ” ë°ì´í„°ê°€ ì¶”ê°€ë˜ëŠ” ëª¨ìŠµì„ ë³¼ìˆ˜ ìˆë‹¤.

### 3) ì…ë ¥ê°’ ë°›ì•„ì™€ì„œ ìœ ì € ì¶”ê°€í•˜ê³  ì‹¶ì–´

í˜„ì¬ëŠ” ê³ ì • ê°’ì„ ë„˜ê²¨ì£¼ê³  ìˆì§€ë§Œ í•œë²ˆ ë³€ê²½í•´ë³´ì.
```jsx
import React, { useReducer, useState } from 'react'
import { userReducer } from '../reducers/userReducer'
import { userData } from '../constants/userData'

function UserList() {
  const [userInput, setUserInput] = useState({
    id: '',
    name: '',
    email: '',
  })
  const userInputHandler = (e) => {
    const { name, value } = e.target
    setUserInput({ ...userInput, [name]: value })
  }

  const [state, dispatch] = useReducer(userReducer, userData)

  return (
    <div>
      {state.map((user) => {
        return <p>{user.name}</p>
      })}
      <input name="id" onChange={userInputHandler}></input>
      <input name="name" onChange={userInputHandler}></input>
      <input name="email" onChange={userInputHandler}></input>
      <button onClick={() => dispatch({type:'ADD', data: userInput})}>ë””ìŠ¤íŒ¨ì¹˜</button>
    </div>
  )
}

export default UserList
```

![](https://velog.velcdn.com/images/jhs000123/post/bc74559a-46e9-4692-af9a-650e6cc67d1b/image.gif)


### 4) ìœ ì € ì •ë³´ë¥¼ ì œê±°í•˜ê³  ì‹¶ì–´

userReduerì— action typeì¤‘ì—ì„œ DELETEë¥¼ ì¶”ê°€í•´ì£¼ê³  ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ìœ ì € ì •ë³´ê°€ ì œê±°ë˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.

1) userReducerì— DELETE typeì— ë”°ë¥¸ í•¨ìˆ˜ í˜¸ì¶œ ë‚´ìš©ì„ ì‘ì„±

```jsx
 case 'DELETE':
            return state.filter((element) => element.id !== action.data.id)
```

2) ì´ì œ ì´ typeì„ í˜¸ì¶œí•˜ëŠ” ë²„íŠ¼ì„ ë§Œë“¤ì–´ì„œ onClickì„ í•˜ë©´ DELETE ì•¡ì…˜ íƒ€ì…ì„ dispatchí•˜ë„ë¡ ì„¤ì •í•˜ë©´ ë—!

```jsx
 {state.map((user) => (
                <div key={user.id}>
                    <p>{user.name}</p>
                    <button onClick={() => dispatch({ type: 'DELETE', id: user.id })}>ì‚­ì œí•˜ê¸°</button>
                </div>
            ))}
```
![](https://velog.velcdn.com/images/jhs000123/post/219ad5b8-5d58-4f84-8589-774bc83de0a5/image.gif)


### 5) ìœ ì € ì •ë³´ ìˆ˜ì •ë„ í•˜ê³ ì‹¶ì€ë°?

userReducerì—ì„œ UPDATE actionì„ ì¶”ê°€í•œë‹¤ (updateëŠ” ì‹¤í–‰ë˜ë©´, ìœ ì €ì˜ name ë¶€ë¶„ì„ ì‹¤í–‰ì‹œ ì¸ìë¡œ ë°›ì€ nameê°’ìœ¼ë¡œ ë³€ê²½í•œë‹¤.)

UserListì—ì„œ í•´ë‹¹ action typeìœ¼ë¡œ dispatchí•œë‹¤.
1) userReducerì— UPDATE typeì— ë”°ë¥¸ í•¨ìˆ˜ í˜¸ì¶œ ë‚´ìš©ì„ ì‘ì„±
```jsx
case 'UPDATE':
            return state.map((element) => (element.id === action.data.id ? { ...element, name: action.data.name } : element))
```
2) ì´ì œ ì´ typeì„ í˜¸ì¶œí•˜ëŠ” ë²„íŠ¼ì„ ë§Œë“¤ì–´ì„œ onClickì„ í•˜ë©´ UPDATE ì•¡ì…˜ íƒ€ì…ì„ dispatchí•˜ë„ë¡ ì„¤ì •í•˜ë©´ ë—! ì´ë•Œ dataê°ì²´ë¡œ ë°›ì•„ì„œ ìˆ˜ì •ì„ í•˜ê¸° ë•Œë¬¸ì— ë³´ë‚¼ë•Œì—ë„ data ê°ì²´ë¡œ ë³´ë‚´ì¤˜ì•¼í•œë‹¤.

```jsx
 <button onClick={() => dispatch({ type: 'UPDATE', data: { id: user.id, name: 'ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.' } })}>ì´ë¦„ ë³€ê²½</button>
```

![](https://velog.velcdn.com/images/jhs000123/post/eb3dd0a3-f29e-445b-84b2-f73acf2dd6ab/image.gif)


## Context

### 1) useContext ê°œë…

íŠ¹ì •í•œ ê°’ì„ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í• ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì–´ ë†“ê³ , ì–´ë””ì„œë“  íŠ¹ì •í•œ ê°’ì„ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš©í• ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” Hoolì´ë‹¤.

```jsx
const UserContext =createContext()

```

`ë°©ê¸ˆ ë§Œë“  ë”°ëˆë”°ëˆí•œ context.Provider`ë¥¼ í†µí•´ì„œ íŠ¹ì • ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¸ì£¼ë©´, valueë¶€ë¶„ì— ëª…ì‹œí•œ ê°’ì„ í•˜ìœ„ì»´í¬ë„ŒíŠ¸ì—ì„œ í•­ìƒ ì‚¬ìš©í• ìˆ˜ ìˆê²Œëœë‹¤.

```jsx
<UserContext.Provider value={ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ê³  ì‹¶ì€ ê°’ }>
  <UserList />
</UserContext.Provider>
```

í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œëŠ” ì•ì„œ ë§Œë“¤ì–´ë†“ì€ contextë¥¼ ë¶ˆëŸ¬ì˜¨ ë‹¤ìŒ useContextë¥¼ ì¨ì£¼ë©´ Providerì˜ valueë¶€ë¶„ì„ í†µí•´ì„œ ë„˜ê²¨ì¤€ ê·¸ ê°’ì„ ë°›ì•„ì˜¬ìˆ˜ ìˆê²Œ ëœë‹¤.

```jsx
import { UserContext } from '../App'
const { value ì— ë„˜ê²¨ì¤¬ë˜ í‚¤ } = useContext(UserContext)
```

- êµ³ì´ í•„ìš”í•¨..?
ì˜ˆë¥¼ ë“¤ì–´ì„œ UserList ì•ˆì— UserDetail ì•ˆì— UserInfo ê°€ ìˆëŠ” í˜•íƒœì—ì„œ, íŠ¹ì •í•œ ê°’ì´ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ ì „ë¶€ì—ì„œ í•„ìš”í•˜ë‹¤ê³  ê°€ì •í•´ë³´ì.

app.jsxì—ì„œ ìƒì„±í•œ ë°ì´í„°ë¥¼ UserInfo ê¹Œì§€ ë‚´ë ¤ì£¼ë ¤ë©´

```jsx
import UserList from './components/UserList'

function App() {
  const [count, setCount] = useState(1)

  return (
    <UserList count={count}/>
  )
}

export default App
```

```jsx
import UserDetail from './components/UserDetail'

function UserList({ count }) {
  return (
    <UserDetail count={count}/>
  )
}

export default UserList
```
```jsx
import UserInfo from './components/UserDetail'

function UserDetail({ count }) {
  return (
    <UserInfo count={count}/>
  )
}

export default UserDetail
```
![](https://velog.velcdn.com/images/jhs000123/post/a9550c19-d4ee-44b7-ab6e-7f345b3f3480/image.png)
ì‰? ì´ë ‡ê²Œê¹Œì§€ í•´ì•¼í•œë‹¤ê³ ?

-> ì´ëŸ° í˜„ìƒì„ `props drilling`ì´ë¼ê³  í•œë‹¤. ëŒ€í‘œì ì¸ anti-pattern ìœ¼ë¡œ, ì‘ë™ì€ í•˜ê² ì§€ë§Œ ì´ë ‡ê²Œ ì‘ì„±í•˜ë©´ í•´ë‹¹ props ê°€ ì–´ë””ì„œë¶€í„° ë‚´ë ¤ìš´ ê²ƒì¸ì§€ íŠ¹ì •í•˜ê¸°ê°€ ì–´ë ¤ì›Œì§„ë‹¤ëŠ” ë‹´ì ì´ ì¡´ì¬í•œë‹¤. ë¿ë§Œ ì•„ë‹ˆë¼ count í•˜ë‚˜ê°€ ë³€ê²½ë˜ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ë‹¤ì‹œ ë Œë”ë§ ë˜ëŠ” ë‹¨ì ë„ ìˆë‹¤.


ì´ê±¸ ë§Œì•½ì— `useContext`ë¥¼ í†µí•´ì„œ í•´ê²°í•œë‹¤ë©´

```jsx
import { createContext, useReducer } from 'react'
import UserList from './components/UserList'
import { userReducer } from './reducers/userReducer'
import { userData } from './constants/userData'

export const UserContext = createContext(null)

function App() {
  const [count, setCount] = useState(1)
	
  return (
    <UserContext.Provider value={{ count }}>
      <UserList />
    </UserContext.Provider>
  )
}

export default App
```
```jsx
import { UserContext } from '../App'

function UserInfo() {
  const { count } = useContext(UserContext)
  return (
    <p>{count}</p>
  )
}

export default UserInfo
```

í›¨ì”¬ ê°„ë‹¨í•˜ë‹¤!


### 2) ì˜ˆì œ

ìœ ì € ì •ë³´ë¥¼ ì „ì—­ì—ì„œ ì €ì¥í•´ë†“ê³  í•„ìš”í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. 

```jsx
import { createContext } from 'react'
import UserList from './component/UserList'

export const UserContext = createContext(null)

function App() {
    const [name, setName] = useState('ë§ë‘ë§ë‘')
    return (
        <UserContext.Provider value={{ name, setName }}>
            <div className="App">
                <UserList />
            </div>
        </UserContext.Provider>
    )
}

export default App

```

`UserInfo` ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ `useContext(ì»¨í…ìŠ¤íŠ¸ì´ë¦„)` í˜•íƒœë¡œ ì‚¬ìš©í•˜ë©´, value ë¶€ë¶„ì˜ ê°’ì„ ê°€ì ¸ì˜¬ìˆ˜ ìˆë‹¤.

```jsx
import React, { useContext } from 'react'
import { UserContext } from '../App'

function UserInfo() {
    const { name } = useContext(UserContext)
    return <div>{name}ë‹˜ ì–´ì„œì™€ìš”!</div>
}

export default UserInfo

```

ì´ì œ Appì—ì„œ UserInfoë¥¼ ë Œë”ë§ í•˜ë©´

![](https://velog.velcdn.com/images/jhs000123/post/1e04769a-81f4-4e8d-a6b8-e00833c40a67/image.png)

ì´ë ‡ê²Œ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ name ê°’ì„ ê°€ì ¸ì˜¬ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

ë¬¼ë¡  setNameë„ ê°€ëŠ¥í•˜ë‹¤.

```jsx
function UserInfo() {
    const { name, setName } = useContext(UserContext)
    return (
        <>
            <div>{name}ë‹˜ ì–´ì„œì™€ìš”!</div>
            <button onClick={() => setName('ë°”ì‚­ë°”ì‚­')}>ë°”ì‚­í•´ì§€ê¸°</button>
        </>
[O    )
}
```
![](https://velog.velcdn.com/images/jhs000123/post/3d2ce57b-9b85-4e77-b671-324a50baffde/image.gif)


### 3) useContext ë¶„ë¦¬í•˜ê¸°

ë§Œì•½ Contextë‚˜ valueê°€ ë§ì•„ì§€ë©´ app.jsxì— ë¡œì§ì´ ë§ì•„ì§€ëŠ” ë¶€ì‘ìš©ì´ ë°œìƒí• ìˆ˜ ìˆë‹¤.

ì´ëŸ¬í•œ context ë¡œì§ì€ ë”°ë¡œ íŒŒì¼ í•˜ë‚˜ë¥¼ ìƒì„±í•´ì„œ ë¶„ë¦¬í•´ì£¼ëŠ” ê²ƒì´ íŒŒì¼ ë° ì½”ë“œ ê´€ë¦¬ì—ë„ ì¢‹ì•„ë³´ì¸ë‹¤.

```jsx
import React, { createContext } from 'react'

export const UserContext = createContext(null)

export function UserProvider({ children }) {
    const [name, setName] = useState('ì•ˆë…•ì•ˆë…•')
    return <UserContext.Provider value={{ name, setName }}>{children}</UserContext.Provider>
}
```

ì´ë ‡ê²Œ ë¶„ë¦¬ë¥¼ í•´ë†“ìœ¼ë©´, ìœ ì €ì™€ ê´€ë ¨ stateë¥¼ ìƒì„±í•˜ëŠ” ë¡œì§ê³¼ ì»´í¬ë„ŒíŠ¸ì— ë„˜ê²¨ì£¼ëŠ” ë¡œì§ì´ `UserProvider`ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ í•˜ë‚˜ë§Œ ì‘ì„±í•˜ë©´ ëª¨ë‘ í•´ê²°ëœë‹¤. 

ì´ë ‡ê²Œ í•´ì£¼ë©´ app.jsxëŠ” ê°„ë‹¨í•˜ê²Œ ì‚¬ìš©í• ìˆ˜ ìˆë‹¤. 

```jsx
import { createContext, useState } from 'react'
import UserInfo from './component/UserInfo'
import UserList from './component/UserList'
import { UserProvider } from './contexts/UserContext'

function App() {
    return (
        <UserProvider>
            <UserInfo />
        </UserProvider>
    )
}

export default App

```

usercontextê°€ ì´ì œ appì— ìˆì§€ì•Šê¸° ë•Œë¬¸ì— ì»´í¬ë„ŒíŠ¸ë„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ì¤€ë‹¤.
```jsx
import React, { useContext } from 'react'
import { UserContext } from './../contexts/UserContext'

function UserInfo() {
    const { name, setName } = useContext(UserContext)
    return (
        <>
            <div>{name}ë‹˜ ì–´ì„œì™€ìš”!</div>
            <button onClick={() => setName('ë°”ì‚­ë°”ì‚­')}>ë°”ì‚­í•´ì§€ê¸°</button>
        </>
    )
}

export default UserInfo

```

### 4) ì´ê±¸ useRuducerë‘ ê°™ì´ ì¨ë³´ê¸°

1) userContext ìˆ˜ì •

```jsx
import React, { createContext, useReducer } from 'react'
import { userReducer } from '../reducers/userReducer'
import { userData } from '../constants/userData'

export const UserContext = createContext(null)

// ìœ„ì—ì„œ ì„ ì–¸í•œ ë‘ê°€ì§€ Context ë“¤ì˜ Provider ë¡œ ê°ì‹¸ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
export function UserProvider({ children }) {
  const [state, dispatch] = useReducer(userReducer, userData)
  return (
    <UserContext.Provider value={{ state, dispatch }}>
      {children}
    </UserContext.Provider>
  )
}
```

app.jsx
```jsx
import { UserProvider } from './contexts/UserContext'
import UserList from './components/UserList'

function App() {
  return (
    <UserProvider>
      <UserList />
    </UserProvider>
  )
}

export default App
```
2) UserList ì—ì„œ useContextë¥¼ ì‚¬ìš©í•˜ì—¬ stateì™€ dispatchë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš©í•œë‹¤.
```jsx
import React, { useContext, useState } from 'react'
import { UserContext } from '../contexts/UserContext'

function UserList() {
    const { state, dispatch } = useContext(UserContext)
    const [userInput, setUserInput] = useState({
        id: '',
        name: '',
        email: '',
    })

    const userInputHandler = (e) => {
        const { name, value } = e.target
        setUserInput({ ...userInput, [name]: value })
    }

    return (
        <div>
            {state.map((user) => (
                <div key={user.id}>
                    <p>{user.name}</p>
                    <button onClick={() => dispatch({ type: 'UPDATE', data: { id: user.id, name: 'ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.' } })}>ì´ë¦„ ë³€ê²½</button>
                    <button onClick={() => dispatch({ type: 'DELETE', id: user.id })}>ì‚­ì œí•˜ê¸°</button>
                </div>
            ))}
            <br></br>
            <input name="id" onChange={userInputHandler} />
            <input name="name" onChange={userInputHandler} />
            <input name="email" onChange={userInputHandler} />

            <button onClick={() => dispatch({ type: 'ADD', data: userInput })}>ë””ìŠ¤íŒ¨ì¹˜</button>
        </div>
    )
}

export default UserList

```
stateì™€ dispatchë§Œ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš©í•˜ë‹ˆê¹Œ ì½”ë“œê°€ ì¡°ê¸ˆ ë‹¨ìˆœí•´ì¡Œë‹¤.


ìœ ì € ì •ë³´ë¥¼ í‘œì‹œí•˜ëŠ” ë¶€ë¶„ì„ ë¶„ë¦¬í•´ì„œ ë¶ˆëŸ¬ì˜¤ëŠ”ì§€ í™•ì¸í•´ë³´ì
`UserList.jsx`
```jsx
[Ifunction UserList() {
    
    const { state: users } = useContext(UserContext)
    return (
        <div>
            {}
            <h1>ë¦¬ìŠ¤íŠ¸</h1>
            {users.map((user) => (
                <UserDetail key={user.id} user={user} />
            ))}
        </div>
    )
}
```
`userDetail.jsx`
```jsx
import React, { useContext } from 'react'
import { UserContext } from '../contexts/UserContext'

function UserDetail({ user }) {
    const { dispatch } = useContext(UserContext)

    return (
        <div key={user.id}>
            <p>{user.name}</p>
            <button onClick={() => dispatch({ type: 'UPDATE', data: { id: user.id, name: 'ë³€ê²½ë¨' } })}>ì´ë¦„ ë°”ê¾¸ê¸°</button>
            <button onClick={() => dispatch({ type: 'REMOVE', data: { id: user.id } })}>ì‚­ì œí•˜ê¸°</button>
        </div>
    )
}

export default UserDetail

```

propsë¡œ ë‚´ë ¤ì£¼ì§€ ì•Šì•˜ëŠ”ë°ë„ sateì™€ dispatchë¥¼ ê°ê° ì˜ ë¶ˆëŸ¬ì˜¨ë‹¤!

![](https://velog.velcdn.com/images/jhs000123/post/db104b0f-e8c2-4011-9191-308f41b1b9d8/image.png)


## Axiosì™€ Reducer(ë‚ ì”¨ ì´ìš©í•´ë³´ê¸°)


### 1) ë‚ ì”¨ apiì‚¬ìš©í•˜ê¸°

axiosë¥¼ í†µí•œ ì‘ë‹µì²˜ë¦¬ë°©ì‹ì„ useReducerë¥¼ í†µí•´ì„œ êµ¬í˜„í•´ë³´ê¸°ë¡œ í•œë‹¤. 

https://open-meteo.com/en/docs#api_form
ì—¬ê¸°ë¡œ ë“¤ì–´ê°€ë©´ ë‹¤ì–‘í•œ ì •ë³´ë¥¼ ì„ íƒí•˜ê³ , apiìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•œ ì£¼ì†Œë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.

![](https://velog.velcdn.com/images/jhs000123/post/51fd4db3-b9d0-44b2-b9b5-62cf6aac6aeb/image.png)

ê°„ë‹¨íˆ ì‹¤ì‹œê°„ ë‚ ì”¨ë§Œ í‘œì‹œí•˜ë„ë¡ ì•„ë˜ì™€ ê°™ì€ urlì„ ì‚¬ìš©í•´ì„œ ìš”ì²­ì„ ë³´ë‚¼ê²ƒì´ë‹¤.

```json
`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`
```


ë¨¼ì € axiosë¥¼ ì„¤ì¹˜í•œë‹¤

> yarn add axios

### 2) axiosì™€ useStateì‚¬ìš©í•´ì„œ ìš”ì²­ ë‹¤ë£¨ê¸°

ë¨¼ì € useStateë§Œ ì‚¬ìš©í•´ì„œ ì§„í–‰í•œë‹¤.
ì•„ë˜ì™€ ê°™ì´, ìƒìˆ˜ í˜•íƒœë¡œ ìœ„ë„, ê²½ë„ë° ë‚ ì”¨ ìƒíƒœë¥¼ ì„ ì–¸

`constants/weather.js`
```jsx
export const GEOLOCATION = {
    'ì„œìš¸': {latitude: 37.55, longitude: 127},
    'ëŸ°ë˜': {latitude: 51.51, longitude: 0},
    'ë‰´ìš•': {latitude: 40.71, longitude: -74.01},
}
export const GRADE = {
    0: 'ë§¤ìš° ë§‘ìŒ',
    1: 'ë§‘ìŒ',
    2: 'ì•½ê°„ íë¦¼',
    3: 'íë¦¼'
}
```

ê·¸ë¦¬ê³  `Weather`ì»´í¬ë„ŒíŠ¸ ìƒì„±

1) getWeather ë©”ì†Œë“œ ì‘ì„±
- locationê°’ì„ ë°”íƒ•ìœ¼ë¡œ latitude, longitudeë¥¼ constantsì˜ weatherë¡œë¶€í„° ê°€ì ¸ì™€ì„œ api ìš”ì²­ urlì˜ ê²½ë„ì˜ ìœ„ë„ê°’ì— ì§‘ì–´ ë„£ëŠ”ë‹¤.

ê·¸ë¦¬ê³  í•´ë‹¹ response.data ë¥¼ ë¦¬í„´í•œë‹¤.

2) setWeatherByResponse ë©”ì†Œë“œ ì‘ì„±

location ê°’ì„ ì‚¬ìš©í•´ì„œ getWeather(location)ì„ í˜¸ì¶œí•œ dataë¥¼ ì‚¬ìš©í•´ì„œ setWeather(data)ë¥¼ í˜¸ì¶œí•˜ì—¬ weatherë°ì´í„°ë¥¼ ë³€ê²½í•œë‹¤. 


```jsx
import React, { useState, useEffect } from 'react'
import { GEOLOCATION, GRADE } from '../constants/weather'
import axios from 'axios'

function Weather() {
    const [weather, setWeather] = useState()
    const getWeather = async (location) => {
        const { latitude, longitude } = GEOLOCATION[location]
        const response = await axios.get(
            `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`,
        )
        return response.data
    }
    const setWeatherByResponse = async (location) => {
        const data = await getWeather(location)
        setWeather(data)
    }

    useEffect(() => {
        setWeatherByResponse('ì„œìš¸')
    }, [])

    return (
        <div>
            <h1>ë‚ ì”¨</h1>
            <p>{weather && weather.current_weather.temperature} ë„</p>
            <p>{weather && GRADE[weather.current_weather.weathercode]}</p>
        </div>
    )
}

export default Weather

```

axios ëŠ” ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ë³´ì—¬ì£¼ê¸°ë§Œ í•œë‹¤ê³  ëì´ ì•„ë‹ˆê³ ,errorë‚˜ loading ê´€ë¦¬ë„ í•´ì¤˜ì•¼í•œë‹¤. 

```jsx
import React, { useState, useEffect } from 'react'
import { GEOLOCATION, GRADE } from '../constatnts/weather'
import axios from 'axios'

import Loading from './../../../seventhApp/src/components/Common/Loading/index'

function Weather() {
    const [weather, setWeather] = useState()
    const [isLoading, setIsLoading] = useState()
    const [error, setError] = useState(null)
    const getWeather = async (location) => {
        try {
            setIsLoading(true)
            const { latitude, longitude } = GEOLOCATION[location]
            const response = await axios.get(
                `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`,
            )
            return response.data
        } catch (err) {
            setError(err)
            setIsLoading(false)
        }
    }
    const setWeatherByResponse = async (location) => {
        const data = await getWeather(location)
        setWeather(data)
        setIsLoading(false)
    }

    useEffect(() => {
        setWeatherByResponse('ì„œìš¸')
    }, [])

    if (isLoading)
        return (
            <div>
                <Loading />
            </div>
        )
    if (error) return <div>{error.message}</div>
    return (
        <div>
            <h1>ë‚ ì”¨</h1>
            <p>{weather && weather.current_weather.temperature} ë„</p>
            <p>{weather && GRADE[weather.current_weather.weathercode]}</p>
        </div>
    )
}

export default Weather

```

- isLoading useState()ìƒì„±
- error useState()ìƒì„±
- try catch ë¬¸ì„ ì‚¬ìš©í•´ì„œ tryì—ëŠ” ì´ì „ì— ì‘ì„±í•œ í˜¸ì¶œ ë‚´ìš©ì„ì‘ì„±í•˜ê³  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì„ë•Œ ë™ì‘í•˜ëŠ” ë‚´ìš©ì„ catch ì— ì‘ì„±í•œë‹¤.
- ë¡œë”©ì¤‘ì¼ ë•ŒëŠ” ì´ì „ì— ë§Œë“  ë¡œë”© ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í–ˆë‹¤.

![](https://velog.velcdn.com/images/jhs000123/post/0b9d3d48-4c09-4e83-9f0e-2dd61f813254/image.gif)


### 3) useReducer ë° useContextë¡œ ì²˜ë¦¬

axiosë¥¼ useReducer ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ìœ ìš©í•œ ì´ìœ ëŠ” ë°”ë¡œ ì—ëŸ¬ì™€ ë¡œë”© ê´€ë¦¬ë¥¼ ì¡°ê¸ˆ ë” íš¨ìœ¨ì ìœ¼ë¡œ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

ì—ëŸ¬, ë¡œë”©, ë°ì´í„°ë¥¼ í•˜ë‚˜ì˜ ê°ì²´ë¡œ ë§Œë“¤ì–´ë†“ê³  í•œë²ˆì— ê´€ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.


1. ë‹¨ìˆœíˆ useReducerë§Œ ì“°ê¸°

`weatherReducer.js`

ìš°ì„   LOADING / SUCCESS / ERROR ì´ 3ê°€ì§€ ê²½ìš°ë§Œ ì¡´ì¬í•œë‹¤ê³  ìƒê°í•˜ê³  ê°€ì •í•˜ê³  ì§„í–‰í•œë‹¤.


```jsx
export function weatherReducer(state, action) {
    switch (action.type) {
        case 'LOADING':
            return {
                loading: true,
                data: null,
                error: null,
            }
        case 'SUCCESS':
            return {
                loading: false,
                data: action.data,
                error: null,
            }
        case 'ERROR':
            return {
                loading: false,
                data: null,
                error: action.error,
            }
        default:
            throw new Error(`Unhandled action type: ${action.type}`)
    }
}

```

Weather.jsx
ë°ì´í„°ì˜ ì´ˆê¸°ê°’ì„ ì•„ë˜ì™€ ê°™ì´ ì •ì˜í•˜ê³  useReducerë¥¼ í†µí•´ì„œ ìƒíƒœê´€ë¦¬ë¥¼ í•œë‹¤.
```jsx
{
    loading: false,
    data: null,
    error: null,
  }
```

```jsx
  const [state, dispatch] = useReducer(weatherReducer, {
    loading: false,
    data: null,
    error: null,
  })
```
`weatherReducer.js`
```jsx
export function weatherReducer(state, action) {
  switch (action.type) {
    case 'LOADING':
      return {
        loading: true,
        data: null,
        error: null,
      }
    case 'SUCCESS':
      return {
        loading: false,
        data: action.data,
        error: null,
      }
    case 'ERROR':
      return {
        loading: false,
        data: null,
        error: action.error,
      }
    default:
      throw new Error(`Unhandled action type: ${action.type}`)
  }
}
```

ì´ì œ ìš”ì²­ë³´ë‚´ëŠ” ë¶€ë¶„ì„ ì•„ë˜ì²˜ëŸ¼ ì‘ì„±í•œë‹¤.
```jsx
function Weather() {
    const [state, dispatch] = useReducer(weatherReducer, {
        loading: false,
        data: null,
        error: null,
    })
    const { loading, data: weather, error } = state
    const getWeather = async (location) => {
        const { latitude, longitude } = GEOLOCATION[location]
        const response = await axios.get(
            `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&timezone=auto`,
        )
        return response.data
    }
    const fetchWeather = async (location) => {
        try {
            dispatch({ type: 'LOADING' })
            const data = await getWeather(location)
            
            dispatch({ type: 'SUCCESS', data })
        } catch (error) {
            dispatch({ type: 'ERROR', error })
        }
    }
    /*    const setWeatherByResponse = async (location) => {
        const data = await getWeather(location)
        setWeather(data)
        setIsLoading(false)
    } */

    useEffect(() => {
        /*  setWeatherByResponse('ì„œìš¸') */
        fetchWeather('ì„œìš¸')
    }, [])

    if (loading)
        return (
            <div>
                <Loading />
            </div>
        )
    if (error) return <div>{error.message}</div>
    return (
        <div>
            <h1>ë‚ ì”¨</h1>
            <p>{weather && weather.current_weather.temperature} ë„</p>
            <p>{weather && GRADE[weather.current_weather.weathercode]}</p>
        </div>
    )
}

export default Weather

```
- loadingê³¼ data, error ë°ì´í„°ë¥¼ weatherReducer ì—ì„œ ê°€ì ¸ì˜¨ë‹¤.
- loading ìƒíƒœê´€ë¦¬ëŠ” reducerê°€ ë‹´ë‹¹í•˜ë¯€ë¡œ useStateëŠ” ì œê±°í•œë‹¤.
- loading ì´ trueì¼ ë™ì•ˆ ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ì„ ë³´ì—¬ì¤€ë‹¤.
- setWeatherByResponse ëŒ€ì‹ ì— fetchWeatherë©”ì†Œë“œë¥¼ ì‘ì„±í–ˆë‹¤. try ë¡œ LOADING íƒ€ì…ì„ dispatchí•˜ê³  getWeatherë¥¼ í˜¸ì¶œí•´ì„œ ì–»ì€ dataë¥¼ ìƒì„±í•˜ê³  SUCCESS typeì„ dispatchí•´ì„œ api í˜¸ì¶œì„ í†µí•´ ì–»ì€ dataë¥¼ state ì— ìˆëŠ” dataë¡œ ì—…ë°ì´íŠ¸í•œë‹¤. 




2. useContextì™€ í•¨ê»˜ ì¨ë³´ê³ ì‹¶ì–´(ë‚ ì”¨ê°€ í•œ ì»´í¬ë„ŒíŠ¸ì—ì„œ í•„ìš”í•œê²Œ ì•„ë‹ˆë¼ ë‹¤ë¥¸ ê³³ì—ì„œë„ í•„ìš”í•˜ë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼í• ê¹Œ?)


ê°„ë‹¨í•˜ë‹¤. contextë¥¼ ìƒì„±í•´ì„œ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì™€ ê³µìœ í•˜ê³  ì‹¶ì€ propsë“¤ì„ ì‘ì„±í•œë‹¤!


- weatherReducerì˜ stateì™€ dispatchë¥¼ ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ë„ ê³µìœ í•´ì•¼ì§€

ê·¸ë ‡ê²Œ í•˜ë ¤ë©´ contextë¥¼ ë§Œë“¤ì–´ì•¼ê² ë„¤
`WeatherContext.jsx`
```jsx
import React, { createContext, useReducer } from 'react'
import { weatherReducer } from '../reducers/weatherReducer'

export const WeatherContext = createContext(null)
const initialState = {
    loading: false,
    data: null,
    error: null,
}

export function WeatherProvider({ children }) {
    const [state, dispatch] = useReducer(weatherReducer, initialState)
    return <WeatherContext.Provider value={{ state, dispatch }}>{children}</WeatherContext.Provider>
}
```

Provider ë‚´ë¶€ì˜ valueì— state, dispatch ë¥¼ ë„£ì–´ì„œ ì‚¬ìš©í• ê±°ì•¼

- App.jsì—ì„œ ì „ë‹¬í•˜ê³ ì í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ì˜ ë°”ê¹¥ì— `WeatherProvider`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë®ëŠ”ë‹¤.

```jsx
import { WeatherProvider } from './contexts/WeatherContext'
import Weather from './components/Weather'

function App() {
    return (
        <WeatherProvider>
            <Weather />
        </WeatherProvider>
    )
}

export default App
```

- ë§ˆì§€ë§‰ìœ¼ë¡œ Weatherì—ì„œ ì‚¬ìš©í•˜ëŠ” state,dispatchë‚´ìš©ì„ ìˆ˜ì •í•´ì£¼ë©´ ë—!
```jsx
 const { state, dispatch } = useContext(WeatherContext) // ì´ ë¶€ë¶„ë§Œ ë‹¬ë¼ì¡ŒìŒ!
```


